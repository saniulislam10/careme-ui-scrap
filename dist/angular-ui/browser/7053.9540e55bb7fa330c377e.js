(self.webpackChunkangular_ui=self.webpackChunkangular_ui||[]).push([[7053],{7053:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PasswordRecoveryModule:()=>A});var n=i(61116),o=i(33464),s=i(35366),r=i(19195),a=i(99896),c=i(56507),h=i(31269),d=i(32456),u=i(31041),l=i(13070),p=i(9550),m=i(77307),g=i(84369),f=i(41293),w=i(35965);function Z(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"div",9),s.TgZ(1,"form",13,3),s.NdJ("ngSubmit",function(){s.CHM(e);const t=s.MAs(2);return s.oxw().onRecoverFormSubmit(t)}),s.TgZ(3,"mat-form-field",4),s.TgZ(4,"mat-label"),s._uU(5,"OTP"),s.qZA(),s._UZ(6,"input",14),s.TgZ(7,"mat-icon",6),s._uU(8,"email"),s.qZA(),s.TgZ(9,"mat-error"),s._uU(10,"This field is required"),s.qZA(),s.qZA(),s.TgZ(11,"div",15),s.TgZ(12,"div",16),s.TgZ(13,"span",17),s._uU(14),s.qZA(),s.qZA(),s.TgZ(15,"div",18),s.TgZ(16,"button",19),s.NdJ("click",function(){return s.CHM(e),s.oxw().resendLoginCode()}),s._uU(17," Resend Code "),s.qZA(),s.TgZ(18,"button",20),s._uU(19," Verify Code "),s.qZA(),s.qZA(),s.qZA(),s.qZA(),s.qZA()}if(2&e){const e=s.oxw();s.xp6(6),s.Q6J("maxLength",6),s.xp6(6),s.Q6J("hidden",0===e.countDown),s.xp6(2),s.Oqu("0:"+e.countDown),s.xp6(2),s.Q6J("fxShow",e.countDown<=0)}}function v(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"form",13,3),s.NdJ("ngSubmit",function(){s.CHM(e);const t=s.MAs(1);return s.oxw().onResetFormSubmit(t)}),s.TgZ(2,"mat-form-field",21),s.TgZ(3,"mat-label"),s._uU(4,"New Password"),s.qZA(),s._UZ(5,"input",22),s.TgZ(6,"mat-icon",6),s._uU(7,"lock"),s.qZA(),s.TgZ(8,"mat-error"),s._uU(9,"This field is required"),s.qZA(),s.qZA(),s.TgZ(10,"mat-form-field",21),s.TgZ(11,"mat-label"),s._uU(12,"Confirm Password"),s.qZA(),s._UZ(13,"input",23),s.TgZ(14,"mat-icon",6),s._uU(15,"lock"),s.qZA(),s.TgZ(16,"mat-error"),s._uU(17,"This field is required"),s.qZA(),s.qZA(),s.TgZ(18,"button",24),s._uU(19,"Reset Password"),s.qZA(),s.qZA()}}const T=[{path:"",component:(()=>{class e{constructor(e,t,i,n,o,s){this.userService=e,this.uiService=t,this.router=i,this.utilsService=n,this.spinner=o,this.bulkSmsService=s,this.phoneNo=null,this.otp=null,this.otpMatched=!1,this.password=null,this.timeInstance=null,this.countDown=0,this.sendVerificationCode=!1,this.showVerificationCodeField=!1,this.expireCountDown=0,this.timeInstanceExpire=null}ngOnInit(){}onPhoneFormSubmit(e){e.invalid?this.uiService.warn("Please enter your phone number"):this.utilsService.checkValidPhone(e.value.phoneNo)&&11===e.value.phoneNo.length?(this.spinner.show(),this.phoneNo=e.value.phoneNo,this.checkAndGetUserByPhone()):this.uiService.warn("Please enter a valid 11 digit phone no")}onRecoverFormSubmit(e){e.invalid||(this.otp=e.value.otp,this.verifyOtpCode())}onResetFormSubmit(e){e.invalid||(e.value.password<6?this.uiService.warn("Password must be at lest 6 characters!"):e.value.password===e.value.confirmPassword?(this.spinner.show(),this.password=e.value.password,this.editPassword()):this.uiService.warn("Password & confirm password not matched"))}checkAndGetUserByPhone(){this.userService.checkAndGetUserByPhone(this.phoneNo).subscribe(e=>{if(e.data){const e="88"+this.phoneNo;this.generatedOtpCode=this.utilsService.getRandomOtpCode6(),this.sendSmsBySslAPi(e,this.generatedOtpCode+" is your OTP (One-Time Password) for password reset at Esquire Electronics. Please enter the OTP to the verification page. Thanks.",e)}else this.spinner.hide(),this.uiService.warn("No account found with this phone number!")},e=>{this.spinner.hide(),console.log(e)})}sendSmsBySslAPi(e,t,i){this.bulkSmsService.sendSmsBySslAPi({sms:t,csmsid:i,msisdn:e}).subscribe(e=>{this.spinner.hide(),e.success?(this.countTime(60),this.countOtpExpireTime(3e3),this.showVerificationCodeField=!0,this.sendVerificationCode=!0):(this.spinner.hide(),this.uiService.wrong("Something went wrong! Please try again."))},e=>{this.uiService.wrong("Something went wrong! Please try again."),console.log(e),this.spinner.hide()})}editPassword(){this.userService.editPassword({phoneNo:this.phoneNo,password:this.password}).subscribe(e=>{this.spinner.hide(),this.uiService.success(e.message),this.router.navigate(["/login"])},e=>{this.spinner.hide(),console.log(e)})}resendLoginCode(){clearInterval(this.timeInstance),clearInterval(this.timeInstanceExpire);const e="88"+this.phoneNo;this.generatedOtpCode=this.utilsService.getRandomOtpCode6(),this.sendSmsBySslAPi(e,this.generatedOtpCode+" is your OTP (One-Time Password) for password reset at Esquire Electronics. Please enter the OTP to the verification page. Thanks.",e)}verifyOtpCode(){this.generatedOtpCode?this.otp===this.generatedOtpCode?(this.otpMatched=!0,this.showVerificationCodeField=!1,this.sendVerificationCode=!1,this.otp=""):this.uiService.wrong("Your OTP code is incorrect!"):this.uiService.wrong("Your OTP code is expired! Please try again")}countTime(e){this.timeInstance=setInterval((e=>()=>{this.countDown=e,(e=0===e?0:e-1)<=0&&(clearInterval(this.timeInstance),this.countDown=0)})(e),1e3)}countOtpExpireTime(e){this.timeInstanceExpire=setInterval((e=>()=>{this.expireCountDown=e,(e=0===e?0:e-1)<=0&&(clearInterval(this.timeInstanceExpire),this.expireCountDown=0,this.generatedOtpCode=null)})(e),1e3)}ngOnDestroy(){this.timeInstance&&clearInterval(this.timeInstance),this.timeInstanceExpire&&clearInterval(this.timeInstanceExpire),this.otpMatched=!1}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(r.K),s.Y36(a.F),s.Y36(o.F0),s.Y36(c.F),s.Y36(h.t2),s.Y36(d.D))},e.\u0275cmp=s.Xpm({type:e,selectors:[["app-password-recovery"]],decls:20,vars:5,consts:[[1,"container"],[1,"form-container","form-phone"],[3,"ngSubmit"],["formDirective","ngForm"],["appearance","outline"],["name","phoneNo","ngModel","","required","","matInput","","placeholder","Phone Number","type","tel",3,"maxLength"],["matSuffix",""],["mat-raised-button","","color","warn","type","submit",3,"fxHide"],["class","form-container login-right-part",4,"ngIf"],[1,"form-container","login-right-part"],["autocomplete","off",3,"ngSubmit",4,"ngIf"],["bdColor","rgba(0,0,0,0.25)","size","medium","color","#fff","type","ball-clip-rotate",2,"width","100vw","height","100vh",3,"fullScreen"],[2,"color","white"],["autocomplete","off",3,"ngSubmit"],["name","otp","ngModel","","required","","matInput","","placeholder","OTP",3,"maxLength"],[1,"bottom-view"],[1,"count-area",3,"hidden"],[1,"count-down"],["fxLayout","row","fxLayoutAlign","space-between center",1,""],["fxHide","","mat-button","","color","primary",1,"button","on-float-left",3,"fxShow","click"],["mat-raised-button","","color","warn","type","submit",1,"btn-submit"],["appearance","outline",1,"password"],["name","password","ngModel","","required","","matInput","","placeholder","Enter new password","type","password"],["name","confirmPassword","ngModel","","required","","matInput","","placeholder","Enter confirm password","type","password"],["mat-raised-button","","color","warn","type","submit"]],template:function(e,t){if(1&e){const e=s.EpF();s.TgZ(0,"div",0),s.TgZ(1,"div",1),s.TgZ(2,"form",2,3),s.NdJ("ngSubmit",function(){s.CHM(e);const i=s.MAs(3);return t.onPhoneFormSubmit(i)}),s.TgZ(4,"mat-form-field",4),s.TgZ(5,"mat-label"),s._uU(6,"Phone Number"),s.qZA(),s._UZ(7,"input",5),s.TgZ(8,"mat-icon",6),s._uU(9,"phone"),s.qZA(),s.TgZ(10,"mat-error"),s._uU(11,"This field is required"),s.qZA(),s.qZA(),s.TgZ(12,"button",7),s._uU(13,"Recover Via Phone Number "),s.qZA(),s.qZA(),s.qZA(),s.YNc(14,Z,20,4,"div",8),s.TgZ(15,"div",9),s.YNc(16,v,20,0,"form",10),s.qZA(),s.qZA(),s.TgZ(17,"ngx-spinner",11),s.TgZ(18,"p",12),s._uU(19," Loading... "),s.qZA(),s.qZA()}2&e&&(s.xp6(7),s.Q6J("maxLength",11),s.xp6(5),s.Q6J("fxHide",t.showVerificationCodeField||t.otpMatched),s.xp6(2),s.Q6J("ngIf",t.showVerificationCodeField),s.xp6(2),s.Q6J("ngIf",t.otpMatched),s.xp6(1),s.Q6J("fullScreen",!0))},directives:[u._Y,u.JL,u.F,l.KE,l.hX,u.Fj,p.Nt,u.JJ,u.On,u.Q7,m.Hw,l.R9,l.TO,g.lW,f.b8,n.O5,h.Ro,w.xw,w.Wh],styles:[".container[_ngcontent-%COMP%]{padding:40px 0}.form-container[_ngcontent-%COMP%]{width:100%;max-width:500px;margin:10px auto}.form-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.form-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]     span{color:#fff}@media only screen and (max-width:599px){.form-container[_ngcontent-%COMP%]{padding:0 12px}}"]}),e})()}];let b=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[o.Bz.forChild(T)],o.Bz]}),e})();var S=i(51428),P=i(56861),x=i(75425);let A=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=s.oAB({type:e}),e.\u0275inj=s.cJS({imports:[[n.ez,b,S.ww,u.u5,P.q,x.m]]}),e})()}}]);